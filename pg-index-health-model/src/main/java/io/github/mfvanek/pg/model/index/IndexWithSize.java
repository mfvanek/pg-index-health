/*
 * Copyright (c) 2019-2025. Ivan Vakhrushev and others.
 * https://github.com/mfvanek/pg-index-health
 *
 * This file is a part of "pg-index-health" - a Java library for
 * analyzing and maintaining indexes health in PostgreSQL databases.
 *
 * Licensed under the Apache License 2.0
 */

package io.github.mfvanek.pg.model.index;

import io.github.mfvanek.pg.model.context.PgContext;
import io.github.mfvanek.pg.model.validation.Validators;

import javax.annotation.Nonnull;
import javax.annotation.concurrent.Immutable;

/**
 * Represents database index with information about size.
 *
 * @author Ivan Vahrushev
 * @since 0.0.1
 */
@Immutable
public class IndexWithSize extends Index implements IndexSizeAware {

    private final long indexSizeInBytes;

    /**
     * Constructs an {@code IndexWithSize} object with the specified table name, index name, and index size.
     *
     * @param tableName        name of the table associated with the index; must be non-blank.
     * @param indexName        name of the index; must be non-blank.
     * @param indexSizeInBytes size of the index in bytes; must be non-negative.
     */
    @SuppressWarnings("WeakerAccess")
    protected IndexWithSize(@Nonnull final String tableName,
                            @Nonnull final String indexName,
                            final long indexSizeInBytes) {
        super(tableName, indexName);
        this.indexSizeInBytes = Validators.sizeNotNegative(indexSizeInBytes, "indexSizeInBytes");
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public long getIndexSizeInBytes() {
        return indexSizeInBytes;
    }

    /**
     * {@inheritDoc}
     */
    @Nonnull
    @Override
    protected String innerToString() {
        return super.innerToString() + ", indexSizeInBytes=" + indexSizeInBytes;
    }

    /**
     * {@inheritDoc}
     */
    @Nonnull
    @Override
    public String toString() {
        return IndexWithSize.class.getSimpleName() + '{' + innerToString() + '}';
    }

    /**
     * Constructs an {@code IndexWithSize} object.
     *
     * @param tableName        table name; should be non-blank.
     * @param indexName        index name; should be non-blank.
     * @param indexSizeInBytes index size in bytes; should be positive or zero.
     * @return {@code IndexWithSize}
     */
    @Nonnull
    public static IndexWithSize of(@Nonnull final String tableName,
                                   @Nonnull final String indexName,
                                   final long indexSizeInBytes) {
        return new IndexWithSize(tableName, indexName, indexSizeInBytes);
    }

    /**
     * Constructs an {@code IndexWithSize} object with given context.
     *
     * @param pgContext        the schema context to enrich table and index name; must be non-null.
     * @param tableName        table name; should be non-blank.
     * @param indexName        index name; should be non-blank.
     * @param indexSizeInBytes index size in bytes; should be positive or zero.
     * @return {@code IndexWithSize}
     * @since 0.14.3
     */
    @Nonnull
    public static IndexWithSize of(@Nonnull final PgContext pgContext,
                                   @Nonnull final String tableName,
                                   @Nonnull final String indexName,
                                   final long indexSizeInBytes) {
        return of(PgContext.enrichWith(tableName, pgContext), PgContext.enrichWith(indexName, pgContext), indexSizeInBytes);
    }

    /**
     * Constructs an {@code IndexWithSize} object with zero size.
     *
     * @param tableName table name; should be non-blank.
     * @param indexName index name; should be non-blank.
     * @return {@code IndexWithSize}
     * @since 0.14.3
     */
    @Nonnull
    public static IndexWithSize of(@Nonnull final String tableName,
                                   @Nonnull final String indexName) {
        return of(tableName, indexName, 0L);
    }

    /**
     * Constructs an {@code IndexWithSize} object with zero size and given context.
     *
     * @param pgContext the schema context to enrich table and index name; must be non-null.
     * @param tableName table name; should be non-blank.
     * @param indexName index name; should be non-blank.
     * @return {@code IndexWithSize}
     * @since 0.14.3
     */
    @Nonnull
    public static IndexWithSize of(@Nonnull final PgContext pgContext,
                                   @Nonnull final String tableName,
                                   @Nonnull final String indexName) {
        return of(pgContext, tableName, indexName, 0L);
    }
}
